"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},5067:(e,s,t)=>{t.r(s),t.d(s,{headerHooks:()=>w,originalPathname:()=>f,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};t.r(a),t.d(a,{DELETE:()=>DELETE,GET:()=>GET,POST:()=>POST,PUT:()=>PUT});var r=t(884),i=t(6132),o=t(5798),n=t(3524),u=t(8192);let c=new n.PrismaClient;async function POST(e){try{let{email:s,username:t,password:a,firstName:r,lastName:i}=await e.json();if(!s||!a)return o.Z.json({success:!1,message:"Email and password are required"},{status:400});if(!(0,u.vV)(s))return o.Z.json({success:!1,message:"Invalid email format"},{status:400});let n=(0,u.eW)(a);if(!n.valid)return o.Z.json({success:!1,message:n.message},{status:400});if(t){let e=(0,u.rh)(t);if(!e.valid)return o.Z.json({success:!1,message:e.message},{status:400})}let l=await c.user.findUnique({where:{email:s.toLowerCase()}});if(l)return o.Z.json({success:!1,message:"User with this email already exists"},{status:409});if(t){let e=await c.user.findUnique({where:{username:t.toLowerCase()}});if(e)return o.Z.json({success:!1,message:"Username is already taken"},{status:409})}let d=await (0,u.c_)(a),m=await c.user.create({data:{email:s.toLowerCase(),username:t?t.toLowerCase():null,password:d,firstName:r||null,lastName:i||null,role:"ARTIST"}}),p=(0,u.RA)({id:m.id,email:m.email,username:m.username,role:m.role}),w=(0,u.LC)();return await c.session.create({data:{userId:m.id,token:w,expiresAt:new Date(Date.now()+6048e5)}}),o.Z.json((0,u.py)(m,p))}catch(e){return console.error("Registration error:",e),o.Z.json({success:!1,message:"Registration failed. Please try again."},{status:500})}}async function PUT(e){try{let{email:s,password:t}=await e.json();if(!s||!t)return o.Z.json({success:!1,message:"Email and password are required"},{status:400});let a=await c.user.findUnique({where:{email:s.toLowerCase()}});if(!a)return o.Z.json({success:!1,message:"Invalid email or password"},{status:401});if(!a.isActive)return o.Z.json({success:!1,message:"Account is deactivated. Please contact support."},{status:401});let r=await (0,u.Gv)(t,a.password);if(!r)return o.Z.json({success:!1,message:"Invalid email or password"},{status:401});let i=(0,u.RA)({id:a.id,email:a.email,username:a.username,role:a.role}),n=(0,u.LC)();return await c.session.create({data:{userId:a.id,token:n,expiresAt:new Date(Date.now()+6048e5)}}),o.Z.json((0,u.py)(a,i))}catch(e){return console.error("Login error:",e),o.Z.json({success:!1,message:"Login failed. Please try again."},{status:500})}}async function GET(e){try{let s=e.headers.get("authorization"),t=(0,u.oA)(s);if(!t)return o.Z.json({success:!1,message:"No token provided"},{status:401});let a=(0,u.WX)(t);if(!a)return o.Z.json({success:!1,message:"Invalid token"},{status:401});let r=await c.user.findUnique({where:{id:a.id},select:{id:!0,email:!0,username:!0,firstName:!0,lastName:!0,avatar:!0,bio:!0,website:!0,role:!0,isVerified:!0,createdAt:!0}});if(!r)return o.Z.json({success:!1,message:"User not found"},{status:404});return o.Z.json({success:!0,data:{user:r}})}catch(e){return console.error("Get user error:",e),o.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function DELETE(e){try{let s=e.headers.get("authorization"),t=(0,u.oA)(s);if(!t)return o.Z.json({success:!1,message:"No token provided"},{status:401});let a=(0,u.WX)(t);if(!a)return o.Z.json({success:!1,message:"Invalid token"},{status:401});return await c.session.deleteMany({where:{userId:a.id}}),o.Z.json({success:!0,message:"Logged out successfully"})}catch(e){return console.error("Logout error:",e),o.Z.json({success:!1,message:"Logout failed"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/auth/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:w,staticGenerationBailout:g}=l,f="/api/auth/route"}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[729,798,752,192],()=>__webpack_exec__(5067));module.exports=t})();