"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},8494:(e,s,t)=>{t.r(s),t.d(s,{headerHooks:()=>v,originalPathname:()=>P,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>y});var a={};t.r(a),t.d(a,{DELETE:()=>DELETE,GET:()=>GET,POST:()=>POST,PUT:()=>PUT});var r=t(884),n=t(6132),i=t(5798),o=t(3524),u=t(5764),c=t(6721),l=t.n(c),d=t(6113);let m=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";async function hashPassword(e){return await u.ZP.hash(e,12)}async function verifyPassword(e,s){return await u.ZP.compare(e,s)}function generateToken(e){return l().sign(e,m,{expiresIn:"7d"})}function verifyToken(e){try{return l().verify(e,m)}catch(e){return null}}function generateSessionToken(){return(0,d.randomBytes)(32).toString("hex")}function isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function isValidPassword(e){return e.length<8?{valid:!1,message:"Password must be at least 8 characters long"}:/(?=.*[a-z])/.test(e)?/(?=.*[A-Z])/.test(e)?/(?=.*\d)/.test(e)?/(?=.*[@$!%*?&])/.test(e)?{valid:!0}:{valid:!1,message:"Password must contain at least one special character (@$!%*?&)"}:{valid:!1,message:"Password must contain at least one number"}:{valid:!1,message:"Password must contain at least one uppercase letter"}:{valid:!1,message:"Password must contain at least one lowercase letter"}}function isValidUsername(e){return e.length<3?{valid:!1,message:"Username must be at least 3 characters long"}:e.length>20?{valid:!1,message:"Username must be less than 20 characters long"}:/^[a-zA-Z0-9_]+$/.test(e)?{valid:!0}:{valid:!1,message:"Username can only contain letters, numbers, and underscores"}}function extractTokenFromHeader(e){if(!e)return null;let s=e.split(" ");return 2!==s.length||"Bearer"!==s[0]?null:s[1]}function createAuthResponse(e,s){return{success:!0,message:"Authentication successful",data:{user:{id:e.id,email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName,avatar:e.avatar,bio:e.bio,website:e.website,role:e.role,isVerified:e.isVerified,createdAt:e.createdAt},token:s,expiresAt:new Date(Date.now()+6048e5)}}}let g=new o.PrismaClient;async function POST(e){try{let{email:s,username:t,password:a,firstName:r,lastName:n}=await e.json();if(!s||!t||!a)return i.Z.json({success:!1,message:"Email, username, and password are required"},{status:400});if(!isValidEmail(s))return i.Z.json({success:!1,message:"Invalid email format"},{status:400});let o=isValidPassword(a);if(!o.valid)return i.Z.json({success:!1,message:o.message},{status:400});let u=isValidUsername(t);if(!u.valid)return i.Z.json({success:!1,message:u.message},{status:400});let c=await g.user.findFirst({where:{OR:[{email:s.toLowerCase()},{username:t.toLowerCase()}]}});if(c)return i.Z.json({success:!1,message:"User with this email or username already exists"},{status:409});let l=await hashPassword(a),d=await g.user.create({data:{email:s.toLowerCase(),username:t.toLowerCase(),password:l,firstName:r||null,lastName:n||null,role:"ARTIST"}}),m=generateToken({id:d.id,email:d.email,username:d.username,role:d.role}),w=generateSessionToken();return await g.session.create({data:{userId:d.id,token:w,expiresAt:new Date(Date.now()+6048e5)}}),i.Z.json(createAuthResponse(d,m))}catch(e){return console.error("Registration error:",e),i.Z.json({success:!1,message:"Registration failed. Please try again."},{status:500})}}async function PUT(e){try{let{email:s,password:t}=await e.json();if(!s||!t)return i.Z.json({success:!1,message:"Email and password are required"},{status:400});let a=await g.user.findUnique({where:{email:s.toLowerCase()}});if(!a)return i.Z.json({success:!1,message:"Invalid email or password"},{status:401});if(!a.isActive)return i.Z.json({success:!1,message:"Account is deactivated. Please contact support."},{status:401});let r=await verifyPassword(t,a.password);if(!r)return i.Z.json({success:!1,message:"Invalid email or password"},{status:401});let n=generateToken({id:a.id,email:a.email,username:a.username,role:a.role}),o=generateSessionToken();return await g.session.create({data:{userId:a.id,token:o,expiresAt:new Date(Date.now()+6048e5)}}),i.Z.json(createAuthResponse(a,n))}catch(e){return console.error("Login error:",e),i.Z.json({success:!1,message:"Login failed. Please try again."},{status:500})}}async function GET(e){try{let s=e.headers.get("authorization"),t=extractTokenFromHeader(s);if(!t)return i.Z.json({success:!1,message:"No token provided"},{status:401});let a=verifyToken(t);if(!a)return i.Z.json({success:!1,message:"Invalid token"},{status:401});let r=await g.user.findUnique({where:{id:a.id},select:{id:!0,email:!0,username:!0,firstName:!0,lastName:!0,avatar:!0,bio:!0,website:!0,role:!0,isVerified:!0,createdAt:!0}});if(!r)return i.Z.json({success:!1,message:"User not found"},{status:404});return i.Z.json({success:!0,data:{user:r}})}catch(e){return console.error("Get user error:",e),i.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function DELETE(e){try{let s=e.headers.get("authorization"),t=extractTokenFromHeader(s);if(!t)return i.Z.json({success:!1,message:"No token provided"},{status:401});let a=verifyToken(t);if(!a)return i.Z.json({success:!1,message:"Invalid token"},{status:401});return await g.session.deleteMany({where:{userId:a.id}}),i.Z.json({success:!0,message:"Logged out successfully"})}catch(e){return console.error("Logout error:",e),i.Z.json({success:!1,message:"Logout failed"},{status:500})}}let w=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/auth/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:v,staticGenerationBailout:y}=w,P="/api/auth/route"}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[729,798,752],()=>__webpack_exec__(8494));module.exports=t})();