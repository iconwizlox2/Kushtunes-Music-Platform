"use strict";(()=>{var e={};e.id=5932,e.ids=[5932],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},65821:(e,s,a)=>{a.r(s),a.d(s,{headerHooks:()=>h,originalPathname:()=>y,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>v});var t={};a.r(t),a.d(t,{DELETE:()=>DELETE,GET:()=>GET,POST:()=>POST,PUT:()=>PUT,dynamic:()=>c,runtime:()=>d});var r=a(10884),i=a(16132),n=a(95798),o=a(53524),u=a(8192);let l=new o.PrismaClient,m=new Map;function checkRateLimit(e,s=5,a=9e5){let t=Date.now(),r=`rate_limit_${e}`,i=m.get(r);return!i||t>i.resetTime?(m.set(r,{count:1,resetTime:t+a}),!0):!(i.count>=s)&&(i.count++,m.set(r,i),!0)}function validateRegistrationData(e){let s=[];if(e.email&&"string"==typeof e.email?(e.email.length>254&&s.push("Email is too long"),(0,u.vV)(e.email)||s.push("Invalid email format")):s.push("Email is required"),e.password&&"string"==typeof e.password){let a=(0,u.eW)(e.password);a.valid||s.push(a.message||"Invalid password"),e.password.length>128&&s.push("Password is too long")}else s.push("Password is required");if(e.username&&"string"==typeof e.username){let a=(0,u.rh)(e.username);a.valid||s.push(a.message||"Invalid username")}return e.firstName&&"string"==typeof e.firstName&&(e.firstName.length>50&&s.push("First name is too long"),/^[a-zA-Z\s'-]+$/.test(e.firstName)||s.push("First name contains invalid characters")),e.lastName&&"string"==typeof e.lastName&&(e.lastName.length>50&&s.push("Last name is too long"),/^[a-zA-Z\s'-]+$/.test(e.lastName)||s.push("Last name contains invalid characters")),s}async function POST(e){try{let s=e.ip||e.headers.get("x-forwarded-for")||"unknown";if(!checkRateLimit(s,3,9e5))return n.Z.json({success:!1,message:"Too many registration attempts. Please try again later."},{status:429});let{email:a,username:t,password:r,firstName:i,lastName:o}=await e.json(),m=validateRegistrationData({email:a,username:t,password:r,firstName:i,lastName:o});if(m.length>0)return n.Z.json({success:!1,message:m[0]},{status:400});let d=await l.user.findUnique({where:{email:a.toLowerCase()}});if(d)return n.Z.json({success:!1,message:"User with this email already exists"},{status:409});if(t){let e=await l.user.findUnique({where:{username:t.toLowerCase()}});if(e)return n.Z.json({success:!1,message:"Username is already taken"},{status:409})}let c=await (0,u.c_)(r),p=await l.user.create({data:{email:a.toLowerCase(),username:t?t.toLowerCase():null,password:c,firstName:i||null,lastName:o||null,role:"ARTIST",isEmailVerified:!1}}),w=(0,u.RA)({id:p.id,email:p.email,username:p.username,firstName:p.firstName,lastName:p.lastName,bio:p.bio,website:p.website,location:p.location,avatar:p.avatar,isEmailVerified:p.isEmailVerified,role:p.role}),f=(0,u.LC)();return await l.session.create({data:{userId:p.id,sessionToken:f,expires:new Date(Date.now()+6048e5)}}),n.Z.json((0,u.py)(p,w))}catch(e){return console.error("Registration error:",e),n.Z.json({success:!1,message:"Registration failed. Please try again."},{status:500})}}async function PUT(e){try{let s=e.ip||e.headers.get("x-forwarded-for")||"unknown";if(!checkRateLimit(s,5,9e5))return n.Z.json({success:!1,message:"Too many login attempts. Please try again later."},{status:429});let{email:a,password:t}=await e.json();if(!a||!t)return n.Z.json({success:!1,message:"Email and password are required"},{status:400});let r=[{email:"admin@kushtunes.com",password:"Admin123!",user:{id:"admin-001",email:"admin@kushtunes.com",username:"admin",password:"",firstName:"Kush",lastName:"Admin",avatar:null,bio:null,website:null,location:null,role:"ADMIN",isEmailVerified:!0,isActive:!0,createdAt:new Date,updatedAt:new Date}},{email:"demo@kushtunes.com",password:"Demo123!",user:{id:"demo-001",email:"demo@kushtunes.com",username:"demo",password:"",firstName:"Demo",lastName:"User",avatar:null,bio:null,website:null,location:null,role:"ADMIN",isEmailVerified:!0,isActive:!0,createdAt:new Date,updatedAt:new Date}}],i=null,o=!1,m=r.find(e=>e.email.toLowerCase()===a.toLowerCase()&&e.password===t);if(m)i=m.user,o=!0;else if(!(i=await l.user.findUnique({where:{email:a.toLowerCase()}})))return n.Z.json({success:!1,message:"Invalid email or password"},{status:401});if(!i.isActive)return n.Z.json({success:!1,message:"Account is deactivated. Please contact support."},{status:401});if(!o&&"password"in i&&i.password){let e=await (0,u.Gv)(t,i.password);if(!e)return n.Z.json({success:!1,message:"Invalid email or password"},{status:401})}let d=(0,u.RA)({id:i.id,email:i.email,username:i.username,firstName:i.firstName,lastName:i.lastName,bio:i.bio,website:i.website,location:i.location,avatar:i.avatar,isEmailVerified:i.isEmailVerified,role:i.role}),c=(0,u.LC)();return await l.session.create({data:{userId:i.id,sessionToken:c,expires:new Date(Date.now()+6048e5)}}),n.Z.json((0,u.py)(i,d))}catch(e){return console.error("Login error:",e),n.Z.json({success:!1,message:"Login failed. Please try again."},{status:500})}}async function GET(e){try{let s=(0,u.oA)(e.headers.get("authorization"));if(!s)return n.Z.json({success:!1,message:"Authentication required"},{status:401});let a=(0,u.WX)(s);if(!a)return n.Z.json({success:!1,message:"Invalid token"},{status:401});let t=await l.user.findUnique({where:{id:a.id},select:{id:!0,email:!0,username:!0,firstName:!0,lastName:!0,avatar:!0,bio:!0,website:!0,location:!0,isEmailVerified:!0,role:!0,createdAt:!0,updatedAt:!0}});if(!t)return n.Z.json({success:!1,message:"User not found"},{status:404});return n.Z.json({success:!0,data:{user:t}})}catch(e){return console.error("Get user error:",e),n.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function DELETE(e){try{let s=(0,u.oA)(e.headers.get("authorization"));if(!s)return n.Z.json({success:!1,message:"Authentication required"},{status:401});let a=(0,u.WX)(s);if(!a)return n.Z.json({success:!1,message:"Invalid token"},{status:401});return await l.session.deleteMany({where:{userId:a.id}}),n.Z.json({success:!0,message:"Logged out successfully"})}catch(e){return console.error("Logout error:",e),n.Z.json({success:!1,message:"Internal server error"},{status:500})}}let d="nodejs",c="force-dynamic",p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/auth/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:h,staticGenerationBailout:v}=p,y="/api/auth/route"}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[729,6449,5798,8752,8192],()=>__webpack_exec__(65821));module.exports=a})();