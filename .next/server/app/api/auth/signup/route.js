"use strict";(()=>{var e={};e.id=3654,e.ids=[3654],e.modules={97352:e=>{e.exports=require("@prisma/client/runtime/library.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},69297:(e,s,a)=>{a.r(s),a.d(s,{headerHooks:()=>f,originalPathname:()=>g,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{POST:()=>POST,PUT:()=>PUT});var t=a(10884),i=a(16132),u=a(95798),n=a(96810),o=a(8192);let l=new n.PrismaClient;async function POST(e){try{let{email:s,password:a,firstName:r,lastName:t,country:i,legalName:n}=await e.json();if(!s||!a||!r||!t||!i||!n)return u.Z.json({success:!1,message:"All fields are required"},{status:400});let c=await l.user.findUnique({where:{email:s}});if(c)return u.Z.json({success:!1,message:"User already exists"},{status:400});let m=await (0,o.c_)(a),d=await l.$transaction(async e=>{let a=await e.user.create({data:{email:s,password:m,firstName:r,lastName:t,role:"ARTIST"}}),u=await e.artist.create({data:{name:`${r} ${t}`,legalName:n,country:i,email:s,kycStatus:"PENDING"}});return{user:a,artist:u}}),p=(0,o.RA)({id:d.user.id,email:d.user.email,username:d.user.username,firstName:d.user.firstName,lastName:d.user.lastName,bio:d.user.bio,website:d.user.website,location:d.user.location,avatar:d.user.avatar,isEmailVerified:d.user.isEmailVerified,role:d.user.role});return u.Z.json({success:!0,message:"Account created successfully",data:{user:{id:d.user.id,email:d.user.email,firstName:d.user.firstName,lastName:d.user.lastName,role:d.user.role},artist:{id:d.artist.id,name:d.artist.name,kycStatus:d.artist.kycStatus},token:p}})}catch(e){return console.error("Signup error:",e),u.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function PUT(e){try{let{email:s,password:a}=await e.json();if(!s||!a)return u.Z.json({success:!1,message:"Email and password are required"},{status:400});let r=await l.user.findUnique({where:{email:s},include:{}});if(!r||!r.password)return u.Z.json({success:!1,message:"Invalid credentials"},{status:401});let t=await (0,o.Gv)(a,r.password);if(!t)return u.Z.json({success:!1,message:"Invalid credentials"},{status:401});if(!r.isActive)return u.Z.json({success:!1,message:"Account is deactivated"},{status:401});let i=(0,o.RA)({id:r.id,email:r.email,username:r.username,firstName:r.firstName,lastName:r.lastName,bio:r.bio,website:r.website,location:r.location,avatar:r.avatar,isEmailVerified:r.isEmailVerified,role:r.role}),n=await l.artist.findUnique({where:{email:r.email}});return u.Z.json({success:!0,message:"Login successful",data:{user:{id:r.id,email:r.email,firstName:r.firstName,lastName:r.lastName,role:r.role},artist:n?{id:n.id,name:n.name,kycStatus:n.kycStatus}:null,token:i}})}catch(e){return console.error("Login error:",e),u.Z.json({success:!1,message:"Internal server error"},{status:500})}}let c=new t.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/auth/signup/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:p,headerHooks:f,staticGenerationBailout:w}=c,g="/api/auth/signup/route"}};var s=require("../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[729,6449,5798,6810,8752,8192],()=>__webpack_exec__(69297));module.exports=a})();