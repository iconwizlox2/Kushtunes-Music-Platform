"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2891:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>m,originalPathname:()=>f,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{GET:()=>GET,POST:()=>POST});var s=a(884),o=a(6132),n=a(5798),i=a(3524),u=a(6113);let d=new i.PrismaClient;async function POST(e){try{let t=await e.formData(),a=t.get("audio"),r=t.get("artwork"),s=t.get("title"),o=t.get("artist"),i=t.get("genre"),l=t.get("language"),c=t.get("releaseDate"),p=t.get("releaseType")||"SINGLE";if(!a||!r||!s||!o)return n.Z.json({success:!1,message:"Missing required fields"},{status:400});let g=(0,u.randomUUID)(),m=(0,u.randomUUID)(),w=(0,u.randomUUID)(),f=`https://kushtunes-storage.com/audio/${m}.${a.name.split(".").pop()}`,h=`https://kushtunes-storage.com/artwork/${w}.${r.name.split(".").pop()}`,U=`USRC${Date.now().toString().slice(-8)}`,y=`${Math.floor(9e11*Math.random())+1e11}`,k=await d.release.create({data:{id:g,title:s,artist:o,type:p,status:"READY",plannedAt:c?new Date(c):new Date,coverUrl:h,audioUrl:f,genre:i,language:l,releaseDate:c?new Date(c):new Date,isrc:U,upc:y}});return await d.track.create({data:{id:m,releaseId:g,title:s,isrc:U,audioUrl:f,duration:Math.floor(300*Math.random())+120}}),n.Z.json({success:!0,message:"Release uploaded successfully",data:{releaseId:k.id,title:k.title,artist:k.artist,status:k.status,audioUrl:k.audioUrl,coverUrl:k.coverUrl,isrc:k.isrc,upc:k.upc,uploadedAt:k.createdAt}})}catch(e){return console.error("Upload error:",e),n.Z.json({success:!1,message:"Upload failed. Please try again."},{status:500})}}async function GET(e){try{let{searchParams:t}=new URL(e.url),a=t.get("releaseId");if(a){let e=await d.release.findUnique({where:{id:a},include:{tracks:!0,distributions:{include:{analytics:{orderBy:{date:"desc"},take:30}}}}});if(!e)return n.Z.json({success:!1,message:"Release not found"},{status:404});return n.Z.json({success:!0,data:e})}{let e=await d.release.findMany({include:{tracks:!0,distributions:{include:{analytics:{orderBy:{date:"desc"},take:7}}}},orderBy:{createdAt:"desc"}});return n.Z.json({success:!0,data:e})}}catch(e){return console.error("Release fetch error:",e),n.Z.json({success:!1,message:"Internal server error"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/upload/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:m,staticGenerationBailout:w}=l,f="/api/upload/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[729,798],()=>__webpack_exec__(2891));module.exports=a})();