"use strict";(()=>{var e={};e.id=887,e.ids=[887],e.modules={7352:e=>{e.exports=require("@prisma/client/runtime/library.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},7134:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>f});var r={};s.r(r),s.d(r,{GET:()=>GET,POST:()=>POST});var a=s(884),i=s(6132),o=s(5798),u=s(6810);let n=new u.PrismaClient;async function GET(e){try{let{searchParams:t}=new URL(e.url),s=t.get("id"),r=t.get("type");if(!s||!r)return o.Z.json({success:!1,message:"Missing file ID or type"},{status:400});let a=null,i="";if("artwork"===r){let e=await n.release.findUnique({where:{id:s},select:{coverUrl:!0}});e?.coverUrl&&(a=e.coverUrl,i="image/jpeg")}else if("audio"===r){let e=await n.track.findUnique({where:{id:s},select:{audioUrl:!0}});e?.audioUrl&&(a=e.audioUrl,i="audio/mpeg")}if(!a)return o.Z.json({success:!1,message:"File not found"},{status:404});return o.Z.json({success:!0,data:{url:a,contentType:i,size:"unknown",lastModified:new Date().toISOString()}})}catch(e){return console.error("File serving error:",e),o.Z.json({success:!1,message:"Failed to serve file"},{status:500})}}async function POST(e){try{let t=await e.formData(),s=t.get("file"),r=t.get("type"),a=t.get("releaseId");if(!s||!r||!a)return o.Z.json({success:!1,message:"Missing required fields"},{status:400});if(s.size>("audio"===r?104857600:10485760))return o.Z.json({success:!1,message:`File too large. Max size: ${"audio"===r?"100MB":"10MB"}`},{status:400});let i=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,u=s.name.split(".").pop(),l=`${i}.${u}`,d=`https://kushtunes-storage.com/${r}/${l}`;return"artwork"===r?await n.release.update({where:{id:a},data:{coverUrl:d}}):"audio"===r&&await n.track.updateMany({where:{releaseId:a},data:{audioUrl:d}}),o.Z.json({success:!0,data:{fileId:i,fileName:l,url:d,size:s.size,type:s.type,uploadedAt:new Date().toISOString()}})}catch(e){return console.error("File upload error:",e),o.Z.json({success:!1,message:"Failed to upload file"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/files/route",pathname:"/api/files",filename:"route",bundlePath:"app/api/files/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/files/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:g,staticGenerationBailout:f}=l,m="/api/files/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[729,798,810],()=>__webpack_exec__(7134));module.exports=s})();