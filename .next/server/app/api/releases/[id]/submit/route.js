"use strict";(()=>{var e={};e.id=125,e.ids=[125],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},7514:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>v,originalPathname:()=>f,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var a={};t.r(a),t.d(a,{POST:()=>POST});var s=t(10884),i=t(16132),u=t(95798),o=t(53524),n=t(8192);let l=new o.PrismaClient;async function POST(e,{params:r}){try{let t=e.headers.get("authorization");if(!t)return u.Z.json({success:!1,message:"Authorization header required"},{status:401});let a=t.replace("Bearer ",""),s=(0,n.WX)(a);if(!s)return u.Z.json({success:!1,message:"Invalid token"},{status:401});let{id:i}=r,{stores:o}=await e.json(),d=await l.artist.findUnique({where:{email:s.email}});if(!d)return u.Z.json({success:!1,message:"Artist profile not found"},{status:404});let c=await l.release.findFirst({where:{id:i,primaryArtistId:d.id},include:{tracks:{include:{contributors:!0,splits:!0}}}});if(!c)return u.Z.json({success:!1,message:"Release not found"},{status:404});let p=await validateReleaseForSubmission(c);if(!p.valid)return u.Z.json({success:!1,message:p.error},{status:400});let m=await Promise.all(o.map(e=>l.delivery.create({data:{releaseId:i,store:e,status:"PENDING",submittedAt:new Date}})));await l.release.update({where:{id:i},data:{status:"UNDER_REVIEW",updatedAt:new Date}});let v=await generateDeliveryPackage(c);return u.Z.json({success:!0,message:"Release submitted for review",data:{releaseId:i,status:"UNDER_REVIEW",deliveries:m.map(e=>({id:e.id,store:e.store,status:e.status})),deliveryPackage:{metadata:v.metadata,assets:v.assets}}})}catch(e){return console.error("Submit release error:",e),u.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function validateReleaseForSubmission(e){if(!e.title)return{valid:!1,error:"Release title is required"};if(!e.upc)return{valid:!1,error:"UPC is required"};if(!e.coverUrl)return{valid:!1,error:"Cover art is required"};if(!e.tracks||0===e.tracks.length)return{valid:!1,error:"Release must have at least one track"};for(let r of e.tracks){if(!r.title)return{valid:!1,error:`Track ${r.trackNumber} title is required`};if(!r.isrc)return{valid:!1,error:`Track ${r.trackNumber} ISRC is required`};if(!r.audioUrl)return{valid:!1,error:`Track ${r.trackNumber} audio file is required`};if(!r.duration||r.duration<=0)return{valid:!1,error:`Track ${r.trackNumber} duration is required`}}return e.releaseDate<=new Date?{valid:!1,error:"Release date must be in the future"}:{valid:!0}}async function generateDeliveryPackage(e){let r={release:{upc:e.upc,title:e.title,version:e.version,label:e.label,releaseDate:e.releaseDate,territories:e.territories,genre:e.genre,subgenre:e.subgenre,copyrightYear:e.copyrightYear,pLine:e.pLine,cLine:e.cLine},tracks:e.tracks.map(e=>({isrc:e.isrc,title:e.title,version:e.version,trackNumber:e.trackNumber,explicit:e.explicit,language:e.language,duration:e.duration,contributors:e.contributors.map(e=>({name:e.name,role:e.role,ipi:e.ipi})),splits:e.splits.map(e=>({percent:e.percent,recoupmentFlag:e.recoupmentFlag}))}))},t={coverArt:e.coverUrl,audioFiles:e.tracks.map(e=>({trackId:e.id,isrc:e.isrc,title:e.title,audioUrl:e.audioUrl}))};return{metadata:r,assets:t}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/releases/[id]/submit/route",pathname:"/api/releases/[id]/submit",filename:"route",bundlePath:"app/api/releases/[id]/submit/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/releases/[id]/submit/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:v,staticGenerationBailout:g}=d,f="/api/releases/[id]/submit/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[729,6449,5798,8752,8192],()=>__webpack_exec__(7514));module.exports=t})();