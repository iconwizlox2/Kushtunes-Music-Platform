"use strict";(()=>{var e={};e.id=5,e.ids=[5],e.modules={97352:e=>{e.exports=require("@prisma/client/runtime/library.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},35299:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>w,originalPathname:()=>y,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var t={};a.r(t),a.d(t,{POST:()=>POST});var s=a(10884),i=a(16132),o=a(95798),u=a(96810),l=a(8192),n=a(57441),d=a.n(n);let p=new u.PrismaClient;async function POST(e,{params:r}){try{let a=e.headers.get("authorization");if(!a)return o.Z.json({success:!1,message:"Authorization header required"},{status:401});let t=a.replace("Bearer ",""),s=(0,l.WX)(t);if(!s)return o.Z.json({success:!1,message:"Invalid token"},{status:401});let{id:i}=r,u=await p.artist.findUnique({where:{email:s.email}});if(!u)return o.Z.json({success:!1,message:"Artist profile not found"},{status:404});let n=await p.release.findFirst({where:{id:i,primaryArtistId:u.id}});if(!n)return o.Z.json({success:!1,message:"Release not found"},{status:404});let d=await e.formData(),c=d.get("audio"),f=d.get("cover"),m=d.get("trackId"),v={};if(c&&m){let e=await validateAudioFile(c);if(!e.valid)return o.Z.json({success:!1,message:e.error},{status:400});let r=await uploadAudioFile(c,`${i}/${m}`);await p.track.update({where:{id:m},data:{audioUrl:r}}),v.audio={url:r,size:c.size,type:c.type}}if(f){let e=await validateCoverFile(f);if(!e.valid)return o.Z.json({success:!1,message:e.error},{status:400});let r=await uploadCoverFile(f,i);await p.release.update({where:{id:i},data:{coverUrl:r}}),v.cover={url:r,size:f.size,type:f.type}}return o.Z.json({success:!0,message:"Assets uploaded successfully",data:v})}catch(e){return console.error("Upload assets error:",e),o.Z.json({success:!1,message:"Internal server error"},{status:500})}}async function validateAudioFile(e){return["audio/wav","audio/wave","audio/x-wav","audio/flac","audio/x-flac"].includes(e.type)?e.size>524288e3?{valid:!1,error:"Audio file must be less than 500MB"}:{valid:!0}:{valid:!1,error:"Only WAV and FLAC files are allowed"}}async function validateCoverFile(e){if(!["image/jpeg","image/png"].includes(e.type))return{valid:!1,error:"Only JPG and PNG files are allowed"};if(e.size>10485760)return{valid:!1,error:"Cover art must be less than 10MB"};try{let r=await e.arrayBuffer(),a=d()(Buffer.from(r)),t=await a.metadata();if(3e3!==t.width||3e3!==t.height)return{valid:!1,error:"Cover art must be exactly 3000x3000 pixels"};if("srgb"!==t.space)return{valid:!1,error:"Cover art must be in RGB color space"}}catch(e){return{valid:!1,error:"Invalid image file"}}return{valid:!0}}async function uploadAudioFile(e,r){return await e.arrayBuffer(),`https://storage.example.com/audio/${r}.${e.name.split(".").pop()}`}async function uploadCoverFile(e,r){let a=await e.arrayBuffer();return await d()(Buffer.from(a)).resize(3e3,3e3,{fit:"cover"}).jpeg({quality:95,mozjpeg:!0}).toBuffer(),`https://storage.example.com/covers/${r}.jpg`}let c=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/releases/[id]/assets/route",pathname:"/api/releases/[id]/assets",filename:"route",bundlePath:"app/api/releases/[id]/assets/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/releases/[id]/assets/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:w,staticGenerationBailout:g}=c,y="/api/releases/[id]/assets/route"}};var r=require("../../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[729,6449,5798,6810,8752,8192],()=>__webpack_exec__(35299));module.exports=a})();