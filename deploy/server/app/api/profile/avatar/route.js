"use strict";(()=>{var e={};e.id=8151,e.ids=[8151],e.modules={97352:e=>{e.exports=require("@prisma/client/runtime/library.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},62693:(e,r,a)=>{a.r(r),a.d(r,{headerHooks:()=>j,originalPathname:()=>q,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>w});var t={};a.r(t),a.d(t,{POST:()=>POST,dynamic:()=>f,runtime:()=>m});var s=a(10884),i=a(16132),o=a(95798),u=a(96810),n=a(8192),p=a(57441),l=a.n(p),c=a(6113);let d=new u.PrismaClient;async function POST(e){try{let r=e.headers.get("authorization")?.replace("Bearer ","");if(!r)return o.Z.json({success:!1,message:"Authentication required"},{status:401});let a=(0,n.WX)(r);if(!a)return o.Z.json({success:!1,message:"Invalid token"},{status:401});let t=await e.formData(),s=t.get("avatar");if(!s)return o.Z.json({success:!1,message:"Avatar file is required"},{status:400});if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type))return o.Z.json({success:!1,message:"Invalid file type. Allowed: JPEG, PNG, WebP"},{status:400});if(s.size>2097152)return o.Z.json({success:!1,message:"File too large. Maximum size: 2MB"},{status:400});let i=Buffer.from(await s.arrayBuffer()),u=await l()(i).resize(400,400,{fit:"cover",withoutEnlargement:!0}).jpeg({quality:85,progressive:!0,mozjpeg:!0}).toBuffer(),p=(0,c.randomUUID)(),m=`https://kushtunes-storage.com/avatars/${p}.jpg`;return await d.user.update({where:{id:a.id},data:{avatar:m,updatedAt:new Date}}),o.Z.json({success:!0,message:"Avatar updated successfully",data:{avatarUrl:m,fileInfo:{size:u.length,type:"image/jpeg",dimensions:"400x400"}}})}catch(e){return console.error("Avatar upload error:",e),o.Z.json({success:!1,message:"Internal server error"},{status:500})}}let m="nodejs",f="force-dynamic",g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/profile/avatar/route",pathname:"/api/profile/avatar",filename:"route",bundlePath:"app/api/profile/avatar/route"},resolvedPagePath:"/Users/wizloxssd/Downloads/kushtunes-starter/app/api/profile/avatar/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:h,headerHooks:j,staticGenerationBailout:w}=g,q="/api/profile/avatar/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[729,6449,5798,6810,8752,8192],()=>__webpack_exec__(62693));module.exports=a})();